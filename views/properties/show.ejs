<% layout('layouts/layout') %>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "RealEstateListing",
  "name": "<%= property.title %>",
  "description": "<%= property.description %>",
  "url": "https://socallistings.com/properties/<%= property._id %>",
  "datePosted": "<%= property.datePosted.toISOString() %>",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "<%= property.address.street %>",
    "addressLocality": "<%= property.city %>",
    "addressRegion": "CA",
    "postalCode": "<%= property.address.zipCode %>",
    "addressCountry": "US"
  },
  "image": ["<%= property.image %>"],
  "offers": {
    "@type": "Offer",
    "price": "<%= property.price %>",
    "priceCurrency": "USD",
    "availability": "https://schema.org/InStock"
  },
  "seller": {
    "@type": "RealEstateAgent",
    "name": "<%= property.owner?.username || 'Property Owner' %>",
    "email": "info@socallistings.com"
  }
}
</script>

<section class="property-show">
  <div class="property-header">
    <img src="<%= property.image || '/images/default-property.jpg' %>" alt="<%= property.title %>" class="property-main-img" />
    <div class="property-header-info">
      <h1><%= property.title %></h1>
      <p class="property-location"><i class="fas fa-map-marker-alt"></i> <%= property.city %>, CA</p>
      <p class="property-price">$<%= property.price.toLocaleString() %></p>
    </div>
  </div>

  <div class="property-content">
    <div class="property-info">
      <h3>Details</h3>
      <ul>
        <li><strong>Type:</strong> <%= property.propertyType %></li>
        <li><strong>Address:</strong> <%= property.address.street %></li>
        <li><strong>Bedrooms:</strong> <%= property.bedrooms %></li>
        <li><strong>Bathrooms:</strong> <%= property.bathrooms %></li>
        <li><strong>Posted:</strong> <%= property.datePosted.toDateString() %></li>
      </ul>

      <h3>Description</h3>
      <p><%= property.description %></p>

      <div class="property-actions">
        <a href="/properties" class="btn btn-secondary">← Back to Listings</a>
        <a href="/contact-owner?propertyId=<%= property._id %>" class="btn btn-info">Contact Owner</a>
      </div>

      <form action="/api/users/save/<%= property._id %>" method="POST" class="save-form">
        <button type="submit" class="btn btn-success">❤️ Save Property</button>
      </form>
    </div>

    <aside class="owner-card">
      <h3>Listing Agent</h3>
      <img src="<%= property.owner?.profileImage || '/images/default-user.png' %>" alt="<%= property.owner?.username || 'Owner' %>" class="owner-avatar" />
      <p><strong><%= property.owner?.username || 'Property Owner' %></strong></p>
      <p>Email: <%= property.owner?.email || 'info@socallistings.com' %></p>
      <p><strong>Role:</strong> <%= property.owner?.role || 'Owner' %></p>
    </aside>
  </div>
</section>

<style>
  .property-show {
    width: 90%;
    margin: 2rem auto;
    max-width: 1100px;
  }

  .property-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .property-main-img {
    width: 100%;
    max-height: 400px;
    object-fit: cover;
    border-radius: 10px;
  }

  .property-header-info {
    margin-top: 1rem;
  }

  .property-price {
    color: #0077cc;
    font-size: 1.5rem;
    font-weight: bold;
  }

  .property-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-top: 2rem;
  }

  .property-info h3 {
    border-bottom: 2px solid #003366;
    padding-bottom: 0.3rem;
    margin-bottom: 0.7rem;
  }

  .property-info ul {
    list-style: none;
    padding: 0;
    margin-bottom: 1.5rem;
  }

  .property-info li {
    margin-bottom: 0.4rem;
  }

  .property-actions {
    margin: 1.5rem 0;
    display: flex;
    gap: 0.5rem;
  }

  .btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 5px;
    color: white;
    text-decoration: none;
  }

  .btn-info { background-color: #0077cc; }
  .btn-secondary { background-color: #555; }
  .btn-success { background-color: #28a745; }
  .btn:hover { opacity: 0.9; }

  .owner-card {
    background: #f9f9f9;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  .owner-avatar {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 50%;
    margin-bottom: 0.5rem;
  }

  @media (max-width: 768px) {
    .property-content {
      grid-template-columns: 1fr;
    }
  }
</style>